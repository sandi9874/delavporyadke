<!DOCTYPE html>
<html>
<head>
    <title>Todo List</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        :root {
            --tg-blue: #0088cc;
            --tg-border: #e7e8ec;
        }
        
        body {
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0;
            padding: 20px 20px 100px;
            background: #fff;
            min-height: 100vh;
            box-sizing: border-box;
        }
        
        .header {
            font-size: 24px;
            color: var(--tg-blue);
            margin-bottom: 15px;
            font-weight: 500;
            display: none;
        }
        
        .todo-list {
            margin-bottom: 25px;
            background: #f9f9f9;
            border-radius: 12px;
            padding: 10px;
            display: none;
        }
        
        .todo-item {
            padding: 12px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            cursor: pointer;
            word-break: break-word;
            hyphens: auto;
        }
        
        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 100;
            transition: transform 0.3s;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--tg-border);
            border-radius: 8px;
            font-size: 16px;
            min-width: 50px;
        }
        
        .date-btn {
            background: white;
            color: var(--tg-blue);
            border: 1px solid var(--tg-blue);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            height: 44px;
            font-size: 14px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .add-btn {
            background: var(--tg-blue);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            height: 44px;
            width: 44px;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-sizing: border-box;
        }
        
        .modal-date {
            padding: 12px;
            border: 1px solid var(--tg-border);
            border-radius: 8px;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        
        .confirm-btn {
            background: var(--tg-blue);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
        }
        
        .cancel-btn {
            background: white;
            color: var(--tg-blue);
            border: 1px solid var(--tg-blue);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
        }
        
        .delete-btn {
            background: white !important;
            color: var(--tg-blue) !important;
            border: 1px solid var(--tg-blue) !important;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
        }
        
        .empty-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #666;
            font-size: 18px;
            padding: 40px 20px;
            display: none;
            width: 90%;
            max-width: 400px;
            z-index: 1;
        }

        @media (max-width: 480px) {
            body {
                padding: 15px 15px 90px;
            }
            
            .input-container {
                gap: 8px;
                padding: 10px;
            }
            
            input[type="text"] {
                font-size: 14px;
                padding: 10px;
            }
            
            .date-btn {
                font-size: 13px;
                padding: 8px;
                height: 40px;
            }
            
            .add-btn {
                height: 40px;
                width: 40px;
                font-size: 18px;
            }
            
            .todo-item {
                font-size: 14px;
                padding: 10px;
            }
            
            .empty-message {
                font-size: 16px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="empty-message" id="empty-message"></div>
    
    <div class="header" id="today-header"></div>
    <div class="todo-list" id="today-todos"></div>
    
    <div class="header" id="tomorrow-header"></div>
    <div class="todo-list" id="tomorrow-todos"></div>
    
    <div class="header">В планах</div>
    <div class="todo-list" id="future-todos"></div>
    
    <div class="input-container">
        <input type="text" id="new-todo" placeholder="Новое дело">
        <button class="date-btn" onclick="openDatePicker()">Дата</button>
        <button class="add-btn" onclick="addTodo()">+</button>
    </div>

    <!-- Модальное окно выбора даты -->
    <div class="modal" id="date-modal">
        <div class="modal-content">
            <input type="date" class="modal-date" id="selected-date">
            <div class="modal-actions">
                <button class="cancel-btn" onclick="closeDatePicker()">Отмена</button>
                <button class="confirm-btn" onclick="confirmDate()">OK</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <input type="text" id="edit-text" class="modal-input">
            <input type="date" id="edit-date" class="modal-date">
            <div class="modal-actions">
                <button class="delete-btn" onclick="deleteTodo()">Удалить</button>
                <button class="confirm-btn" onclick="saveEdit()">Сохранить</button>
            </div>
        </div>
    </div>

    <script>
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        let selectedDate = null;
        let editingId = null;

        // Обработчик изменения размера экрана
        let viewport = document.querySelector("meta[name=viewport]");
        let initialViewport = viewport.content;
        
        function handleFocus() {
            viewport.content = 'width=device-width, initial-scale=1, maximum-scale=1';
            setTimeout(() => document.documentElement.scrollTop = document.documentElement.scrollHeight, 100);
        }
        
        function handleBlur() {
            viewport.content = initialViewport;
        }

        function updateHeaders() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            document.getElementById('today-header').textContent = `Сегодня, ${formatDate(today)}`;
            document.getElementById('tomorrow-header').textContent = `Завтра, ${formatDate(tomorrow)}`;
            
            document.getElementById('empty-message').textContent = 
                `На сегодня (${formatDate(today)}) дел нет. И это прекрасно`;
        }

        function formatDate(date) {
            const options = { day: 'numeric', month: 'long', weekday: 'short' };
            return date.toLocaleDateString('ru-RU', options);
        }

        function renderTodos() {
            const today = new Date().toDateString();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const todayTodos = todos.filter(t => t.date && new Date(t.date).toDateString() === today);
            const tomorrowTodos = todos.filter(t => t.date && new Date(t.date).toDateString() === tomorrow.toDateString());
            const futureTodos = todos.filter(t => !t.date || (
                new Date(t.date).toDateString() !== today && 
                new Date(t.date).toDateString() !== tomorrow.toDateString()
            ));

            const hasToday = todayTodos.length > 0;
            const hasTomorrow = tomorrowTodos.length > 0;
            const hasFuture = futureTodos.length > 0;
            const anyTasks = hasToday || hasTomorrow || hasFuture;

            document.getElementById('empty-message').style.display = anyTasks ? 'none' : 'block';
            
            toggleSection('today-header', 'today-todos', hasToday);
            renderList('today-todos', todayTodos);
            
            toggleSection('tomorrow-header', 'tomorrow-todos', hasTomorrow);
            renderList('tomorrow-todos', tomorrowTodos);
            
            toggleSection('future-todos', 'future-todos', hasFuture, 'В планах');
            renderList('future-todos', futureTodos);
        }

        function toggleSection(headerId, listId, show, customHeader = null) {
            const header = document.getElementById(headerId);
            const list = document.getElementById(listId);
            
            if(customHeader) {
                header.previousElementSibling.style.display = show ? 'block' : 'none';
            } else {
                header.style.display = show ? 'block' : 'none';
            }
            list.style.display = show ? 'block' : 'none';
        }

        function renderList(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map(todo => `
                <div class="todo-item" onclick="openEdit(${todo.id})">
                    ${todo.text}
                </div>
            `).join('');
        }

        function openDatePicker() {
            document.getElementById('date-modal').style.display = 'flex';
        }

        function closeDatePicker() {
            document.getElementById('date-modal').style.display = 'none';
        }

        function confirmDate() {
            const dateValue = document.getElementById('selected-date').value;
            selectedDate = dateValue ? new Date(dateValue) : null;
            closeDatePicker();
        }

        function addTodo() {
            const text = document.getElementById('new-todo').value;
            if (!text) return;
            
            const newTodo = {
                id: Date.now(),
                text,
                date: selectedDate ? selectedDate.toISOString().split('T')[0] : null
            };
            
            todos.push(newTodo);
            
            document.getElementById('new-todo').value = '';
            document.getElementById('selected-date').value = '';
            selectedDate = null;
            
            saveAndRender();
        }

        function openEdit(id) {
            editingId = id;
            const todo = todos.find(t => t.id === id);
            document.getElementById('edit-text').value = todo.text;
            document.getElementById('edit-date').value = todo.date || '';
            document.getElementById('edit-modal').style.display = 'flex';
        }

        function saveEdit() {
            const todo = todos.find(t => t.id === editingId);
            todo.text = document.getElementById('edit-text').value;
            todo.date = document.getElementById('edit-date').value || null;
            document.getElementById('edit-modal').style.display = 'none';
            saveAndRender();
        }

        function deleteTodo() {
            todos = todos.filter(t => t.id !== editingId);
            document.getElementById('edit-modal').style.display = 'none';
            saveAndRender();
        }

        function saveAndRender() {
            localStorage.setItem('todos', JSON.stringify(todos));
            updateHeaders();
            renderTodos();
        }

        // Обработчики событий
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        document.getElementById('new-todo').addEventListener('focus', handleFocus);
        document.getElementById('new-todo').addEventListener('blur', handleBlur);

        // Инициализация
        updateHeaders();
        renderTodos();
    </script>
</body>
</html>
